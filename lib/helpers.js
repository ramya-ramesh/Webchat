"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("core-js/modules/es.array.slice.js");

require("core-js/modules/es.object.to-string.js");

require("core-js/modules/es.regexp.to-string.js");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validButtonContent = exports.safeStringValue = exports.safeBooleanValue = exports.safeArrayOfItem = exports.getCredentialsFromLocalStorage = exports.storeCredentialsToLocalStorage = exports.getCredentialCookieName = exports.truncate = void 0;

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var truncate = function truncate(string, length) {
  //  console.assert(typeof string === 'string', `Expected a 'string', but got a type:'${typeof string}' - '${string}'`)
  if (typeof string === 'string') {
    if (string.length <= length) {
      return string;
    }

    return "".concat(string.slice(0, length - 3), "...");
  }

  return '';
};

exports.truncate = truncate;

var getCredentialCookieName = function getCredentialCookieName(channelId) {
  return "cai-conversation-".concat(channelId);
};

exports.getCredentialCookieName = getCredentialCookieName;

var storeCredentialsToLocalStorage = function storeCredentialsToLocalStorage(chatId, conversationId, timeToLive, channelId) {
  var payload = {
    chatId: chatId,
    conversationId: conversationId
  };
  var maxAge = 3600 * timeToLive;

  if (typeof window.sessionStorage !== 'undefined') {
    // if maxAge is 0 then it never expires.
    // Currently timeToLive is 0.002777777 (~1 sec) if set to never.
    var expire = maxAge > 0 ? new Date().getTime() + maxAge * 1000 : 0;
    var localData = {
      expire: expire,
      payload: payload
    };
    sessionStorage.setItem(getCredentialCookieName(channelId), JSON.stringify(localData));
  }
};

exports.storeCredentialsToLocalStorage = storeCredentialsToLocalStorage;

var getCredentialsFromLocalStorage = function getCredentialsFromLocalStorage(channelId) {
  if (typeof window.sessionStorage !== 'undefined') {
    var localStorageData = sessionStorage.getItem(getCredentialCookieName(channelId));

    if (localStorageData) {
      try {
        var time = new Date().getTime();
        var localData = JSON.parse(localStorageData);
        var secondsLeftBeforeExpires = localData.expire === 0 ? 9999 : parseInt((localData.expire - time) / 1000, 10);

        if (secondsLeftBeforeExpires > 0) {
          return localData.payload;
        } // The data has expired if we got here, so remove it from the storage.


        sessionStorage.removeItem(getCredentialCookieName(channelId));
      } catch (err) {} // eslint-disable-line no-empty

    }
  }

  return null;
};

exports.getCredentialsFromLocalStorage = getCredentialsFromLocalStorage;

var safeArrayOfItem = function safeArrayOfItem(items) {
  // Assert is for testing only
  // BCP: https://support.wdf.sap.corp/sap/support/message/2080400256
  // console.assert(items && Array.isArray(items), `Expected a array of items, but got a type:'${typeof items}'`)
  if (items && Array.isArray(items)) {
    return items;
  }

  return [];
};

exports.safeArrayOfItem = safeArrayOfItem;

var safeBooleanValue = function safeBooleanValue(flag) {
  if (typeof flag === 'boolean') {
    return flag;
  } else if (typeof flag === 'string') {
    return flag.toLowerCase() === 'true';
  }

  return false;
};

exports.safeBooleanValue = safeBooleanValue;

var safeStringValue = function safeStringValue(content) {
  if (typeof content === 'string') {
    return content;
  } else if ((0, _typeof2.default)(content) === 'object') {
    return JSON.stringify(content);
  } else if (typeof content === 'number') {
    return content.toString();
  } else if (content === undefined) {
    return 'undefined';
  }

  return '';
};

exports.safeStringValue = safeStringValue;

var validButtonContent = function validButtonContent(element) {
  if (element) {
    var type = element.type,
        value = element.value,
        title = element.title;
    var data = {
      type: type,
      value: value,
      title: title
    };
    return data;
  }

  return element;
};

exports.validButtonContent = validButtonContent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbInRydW5jYXRlIiwic3RyaW5nIiwibGVuZ3RoIiwic2xpY2UiLCJnZXRDcmVkZW50aWFsQ29va2llTmFtZSIsImNoYW5uZWxJZCIsInN0b3JlQ3JlZGVudGlhbHNUb0xvY2FsU3RvcmFnZSIsImNoYXRJZCIsImNvbnZlcnNhdGlvbklkIiwidGltZVRvTGl2ZSIsInBheWxvYWQiLCJtYXhBZ2UiLCJ3aW5kb3ciLCJzZXNzaW9uU3RvcmFnZSIsImV4cGlyZSIsIkRhdGUiLCJnZXRUaW1lIiwibG9jYWxEYXRhIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDcmVkZW50aWFsc0Zyb21Mb2NhbFN0b3JhZ2UiLCJsb2NhbFN0b3JhZ2VEYXRhIiwiZ2V0SXRlbSIsInRpbWUiLCJwYXJzZSIsInNlY29uZHNMZWZ0QmVmb3JlRXhwaXJlcyIsInBhcnNlSW50IiwicmVtb3ZlSXRlbSIsImVyciIsInNhZmVBcnJheU9mSXRlbSIsIml0ZW1zIiwiQXJyYXkiLCJpc0FycmF5Iiwic2FmZUJvb2xlYW5WYWx1ZSIsImZsYWciLCJ0b0xvd2VyQ2FzZSIsInNhZmVTdHJpbmdWYWx1ZSIsImNvbnRlbnQiLCJ0b1N0cmluZyIsInVuZGVmaW5lZCIsInZhbGlkQnV0dG9uQ29udGVudCIsImVsZW1lbnQiLCJ0eXBlIiwidmFsdWUiLCJ0aXRsZSIsImRhdGEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ08sSUFBTUEsUUFBUSxHQUFHLFNBQVhBLFFBQVcsQ0FBQ0MsTUFBRCxFQUFTQyxNQUFULEVBQW9CO0FBQzVDO0FBQ0UsTUFBSSxPQUFPRCxNQUFQLEtBQWtCLFFBQXRCLEVBQWdDO0FBQzlCLFFBQUlBLE1BQU0sQ0FBQ0MsTUFBUCxJQUFpQkEsTUFBckIsRUFBNkI7QUFDM0IsYUFBT0QsTUFBUDtBQUNEOztBQUVELHFCQUFVQSxNQUFNLENBQUNFLEtBQVAsQ0FBYSxDQUFiLEVBQWdCRCxNQUFNLEdB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QVA7QUFDRCxDQVBNOzs7O0FBU0EsSUFBTUMsZUFBZSxHQUFHLFNBQWxCQSxlQUFrQixDQUFDQyxPQUFELEVBQWE7QUFDMUMsTUFBSSxPQUFPQSxPQUFQLEtBQW1CLFFBQXZCLEVBQWlDO0FBQy9CLFdBQU9BLE9BQVA7QUFDRCxHQUZELE1BRU8sSUFBSSxzQkFBT0EsT0FBUCxNQUFtQixRQUF2QixFQUFpQztBQUN0QyxXQUFPbkIsSUFBSSxDQUFDQyxTQUFMLENBQWVrQixPQUFmLENBQVA7QUFDRCxHQUZNLE1BRUEsSUFBSSxPQUFPQSxPQUFQLEtBQW1CLFFBQXZCLEVBQWlDO0FBQ3RDLFdBQU9BLE9BQU8sQ0FBQ0MsUUFBUixFQUFQO0FBQ0QsR0FGTSxNQUVBLElBQUlELE9BQU8sS0FBS0UsU0FBaEIsRUFBMkI7QUFDaEMsV0FBTyxXQUFQO0FBQ0Q7O0FBQ0QsU0FBTyxFQUFQO0FBQ0QsQ0FYTTs7OztBQWFBLElBQU1DLGtCQUFrQixHQUFHLFNBQXJCQSxrQkFBcUIsQ0FBQ0MsT0FBRCxFQUFhO0FBQzdDLE1BQUlBLE9BQUosRUFBYTtBQUFBLFFBQ0hDLElBREcsR0FDb0JELE9BRHBCLENBQ0hDLElBREc7QUFBQSxRQUNHQyxLQURILEdBQ29CRixPQURwQixDQUNHRSxLQURIO0FBQUEsUUFDVUMsS0FEVixHQUNvQkgsT0FEcEIsQ0FDVUcsS0FEVjtBQUVYLFFBQU1DLElBQUksR0FBRztBQUNYSCxNQUFBQSxJQUFJLEVBQUpBLElBRFc7QUFFWEMsTUFBQUEsS0FBSyxFQUFMQSxLQUZXO0FBR1hDLE1BQUFBLEtBQUssRUFBTEE7QUFIVyxLQUFiO0FBS0EsV0FBT0MsSUFBUDtBQUNEOztBQUNELFNBQU9KLE9BQVA7QUFDRCxDQVhNIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmV4cG9ydCBjb25zdCB0cnVuY2F0ZSA9IChzdHJpbmcsIGxlbmd0aCkgPT4ge1xyXG4vLyAgY29uc29sZS5hc3NlcnQodHlwZW9mIHN0cmluZyA9PT0gJ3N0cmluZycsIGBFeHBlY3RlZCBhICdzdHJpbmcnLCBidXQgZ290IGEgdHlwZTonJHt0eXBlb2Ygc3RyaW5nfScgLSAnJHtzdHJpbmd9J2ApXHJcbiAgaWYgKHR5cGVvZiBzdHJpbmcgPT09ICdzdHJpbmcnKSB7XHJcbiAgICBpZiAoc3RyaW5nLmxlbmd0aCA8PSBsZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIHN0cmluZ1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBgJHtzdHJpbmcuc2xpY2UoMCwgbGVuZ3RoIC0gMyl9Li4uYFxyXG4gIH1cclxuICByZXR1cm4gJydcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGdldENyZWRlbnRpYWxDb29raWVOYW1lID0gKGNoYW5uZWxJZCkgPT4ge1xyXG4gIHJldHVybiBgY2FpLWNvbnZlcnNhdGlvbi0ke2NoYW5uZWxJZH1gXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzdG9yZUNyZWRlbnRpYWxzVG9Mb2NhbFN0b3JhZ2UgPSAoY2hhdElkLCBjb252ZXJzYXRpb25JZCwgdGltZVRvTGl2ZSwgY2hhbm5lbElkKSA9PiB7XHJcbiAgY29uc3QgcGF5bG9hZCA9IHsgY2hhdElkLCBjb252ZXJzYXRpb25JZCB9XHJcbiAgY29uc3QgbWF4QWdlID0gMzYwMCAqIHRpbWVUb0xpdmVcclxuXHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAvLyBpZiBtYXhBZ2UgaXMgMCB0aGVuIGl0IG5ldmVyIGV4cGlyZXMuXHJcbiAgICAvLyBDdXJyZW50bHkgdGltZVRvTGl2ZSBpcyAwLjAwMjc3Nzc3NyAofjEgc2VjKSBpZiBzZXQgdG8gbmV2ZXIuXHJcbiAgICBjb25zdCBleHBpcmUgPSBtYXhBZ2UgPiAwID8gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyAobWF4QWdlICogMTAwMCkgOiAwXHJcbiAgICBjb25zdCBsb2NhbERhdGEgPSB7IGV4cGlyZSwgcGF5bG9hZCB9XHJcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGdldENyZWRlbnRpYWxDb29raWVOYW1lKGNoYW5uZWxJZCksIEpTT04uc3RyaW5naWZ5KGxvY2FsRGF0YSkpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q3JlZGVudGlhbHNGcm9tTG9jYWxTdG9yYWdlID0gKGNoYW5uZWxJZCkgPT4ge1xyXG4gIGlmICh0eXBlb2Ygd2luZG93LnNlc3Npb25TdG9yYWdlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgY29uc3QgbG9jYWxTdG9yYWdlRGF0YSA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oZ2V0Q3JlZGVudGlhbENvb2tpZU5hbWUoY2hhbm5lbElkKSlcclxuXHJcbiAgICBpZiAobG9jYWxTdG9yYWdlRGF0YSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG4gICAgICAgIGNvbnN0IGxvY2FsRGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlRGF0YSlcclxuICAgICAgICBjb25zdCBzZWNvbmRzTGVmdEJlZm9yZUV4cGlyZXMgPSBsb2NhbERhdGEuZXhwaXJlID09PSAwID8gOTk5OSA6IHBhcnNlSW50KChsb2NhbERhdGEuZXhwaXJlIC0gdGltZSkgLyAxMDAwLCAxMClcclxuICAgICAgICBpZiAoc2Vjb25kc0xlZnRCZWZvcmVFeHBpcmVzID4gMCkge1xyXG4gICAgICAgICAgcmV0dXJuIGxvY2FsRGF0YS5wYXlsb2FkXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRoZSBkYXRhIGhhcyBleHBpcmVkIGlmIHdlIGdvdCBoZXJlLCBzbyByZW1vdmUgaXQgZnJvbSB0aGUgc3RvcmFnZS5cclxuICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGdldENyZWRlbnRpYWxDb29raWVOYW1lKGNoYW5uZWxJZCkpXHJcbiAgICAgIH0gY2F0Y2ggKGVycikge30gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1lbXB0eVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gbnVsbFxyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgc2FmZUFycmF5T2ZJdGVtID0gKGl0ZW1zKSA9PiB7XHJcbiAgLy8gQXNzZXJ0IGlzIGZvciB0ZXN0aW5nIG9ubHlcclxuICAvLyBCQ1A6IGh0dHBzOi8vc3VwcG9ydC53ZGYuc2FwLmNvcnAvc2FwL3N1cHBvcnQvbWVzc2FnZS8yMDgwNDAwMjU2XHJcbiAgLy8gY29uc29sZS5hc3NlcnQoaXRlbXMgJiYgQXJyYXkuaXNBcnJheShpdGVtcyksIGBFeHBlY3RlZCBhIGFycmF5IG9mIGl0ZW1zLCBidXQgZ290IGEgdHlwZTonJHt0eXBlb2YgaXRlbXN9J2ApXHJcbiAgaWYgKGl0ZW1zICYmIEFycmF5LmlzQXJyYXkoaXRlbXMpKSB7XHJcbiAgICByZXR1cm4gaXRlbXNcclxuICB9XHJcbiAgcmV0dXJuIFtdXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzYWZlQm9vbGVhblZhbHVlID0gKGZsYWcpID0+IHtcclxuICBpZiAodHlwZW9mIGZsYWcgPT09ICdib29sZWFuJykge1xyXG4gICAgcmV0dXJuIGZsYWdcclxuICB9IGVsc2UgaWYgKHR5cGVvZiBmbGFnID09PSAnc3RyaW5nJykge1xyXG4gICAgcmV0dXJuIGZsYWcudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnXHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZVxyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgc2FmZVN0cmluZ1ZhbHVlID0gKGNvbnRlbnQpID0+IHtcclxuICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICByZXR1cm4gY29udGVudFxyXG4gIH0gZWxzZSBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdvYmplY3QnKSB7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY29udGVudClcclxuICB9IGVsc2UgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnbnVtYmVyJykge1xyXG4gICAgcmV0dXJuIGNvbnRlbnQudG9TdHJpbmcoKVxyXG4gIH0gZWxzZSBpZiAoY29udGVudCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICByZXR1cm4gJ3VuZGVmaW5lZCdcclxuICB9XHJcbiAgcmV0dXJuICcnXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCB2YWxpZEJ1dHRvbkNvbnRlbnQgPSAoZWxlbWVudCkgPT4ge1xyXG4gIGlmIChlbGVtZW50KSB7XHJcbiAgICBjb25zdCB7IHR5cGUsIHZhbHVlLCB0aXRsZSB9ID0gZWxlbWVudFxyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgdHlwZSxcclxuICAgICAgdmFsdWUsXHJcbiAgICAgIHRpdGxlLFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRhdGFcclxuICB9XHJcbiAgcmV0dXJuIGVsZW1lbnRcclxufVxyXG4iXX0=